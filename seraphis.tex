\documentclass{article}
\usepackage[top=1.0in,bottom=1.0in,left=1.0in,right=1.0in]{geometry}
\usepackage{amsmath,amssymb,amsthm,amsfonts}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{graphicx}

\newtheorem{definition}{Definition}[section]
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem*{remark}{Remark}

\title{A Report on Seraphis}
\author{coinstudent2048}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
This document contains a concise description of Seraphis \cite{seraphis}, a novel privacy-preserving transaction protocol abstraction, and a security analysis for it.
\end{abstract}

\section{Preliminaries}
\subsection{Public parameters and notations}
\noindent Let $\mathbb{G}$ be a prime order group where the Discrete Logarithm (DL) problem is hard and the Decisional Diffie-Hellman assumption (DDH) holds, and let $\mathbb{F}$ be its scalar field. Let $G_0, G_1, H_0, H_1$ be generators of $\mathbb{G}$ with unknown DL relationship to each other. Note that these generators may be produced using public randomness. Let $\mathcal{H}:\{0,1\}^*\rightarrow\mathbb{F}$ be a cryptographic hash function. We add a subscript to $\mathcal{H}$, such as $\mathcal{H}_1$, in lieu of domain-separating the hash function explicitly; any domain-separation method may be used in practice.

The notation $\leftarrow_R$ will be used to denote for a uniformly randomly chosen element, and $(1/x)$ for the modular inverse of $x\in\mathbb{F}$. Lastly, we use additive notation for group operations.

\subsection{E-notes and e-note images}
\begin{definition}\label{e-note}
An \textbf{\em e-note} for scalars $k_a^o, k_b^o, a \in\mathbb{F}$ is a tuple $(C, K^o, m)$ such that $C = x H_0 + a H_1$ for $x\leftarrow_R\mathbb{F}$, $K^o=k_b^o G_0 + k_a^o G_1$, and $m$ is an arbitrary data.
\end{definition}
$C$ is called the \textbf{amount commitment} for the amount $a$ with blinding factor $x$, $K^o$ is called the \textbf{one-time address} for (one-time) private keys $k_a^o$ and $k_b^o$ (the $o$ superscript indicates ``one-time''), and $m$ is the \textbf{memo field}. We say that someone \textit{owns} an e-note if they know the corresponding scalars $k_a^o, k_b^o, a, x \in\mathbb{F}$.

\begin{definition}\label{e-note-img}
An \textbf{\em e-note image} for an e-note $(C, K^o, m)$ is a tuple $(C', K'^o, \tilde{K})$ such that
\begin{align*}
C' &= t_c H_o + C \\ &= (t_c+x)H_0 + aH_1 \\ &= v_c H_o + aH_1 \ , \\
K'^o &= t_k G_0 + K^o \\ &= (t_k + k_b^o) G_0 + k_a^o G_1 \\ &= v_k G_0 + k_a^o G_1 \ ,\ \text{and} \\
\tilde{K} &= (1/k_a^o)G_0
\end{align*}
for $t_c, t_k \leftarrow_R\mathbb{F}$ and independent to each other.
\end{definition}
$C'$ is called the \textbf{masked amount commitment}, $K'^o$ is called the \textbf{masked address}, and $\tilde{K}$ is called the \textbf{linking tag}.

\begin{definition}\label{recv-addr}
A \textbf{\em receiver address} is a tuple $(K^{dh}, K^v, K^s)$  such that $K^{dh}\in\mathbb{G}$, $K^v = k^v K^{dh}$, and $K^s = k_b^s G_0 + k_a^s G_1$.
\end{definition}
$K^{dh}$ is called the \textbf{Diffie-Hellman base public key}, the $v$ superscript indicates ``view'', and the $s$ superscript indicates ``spend''. The reason for the name of $K^{dh}$ will be clear in the next section, while the reason for the names of superscripts is outside the scope of this document. We say that someone \textit{owns} a receiver address if they know the corresponding scalars $k^v, k_a^s, k_b^s \in\mathbb{F}$.

\subsection{Symmetric encryption scheme}
We require the use of a symmetric encryption scheme. The Diffie-Hellman base public key enables shared secrets between the sender and the receiver. We denote the encryption and decryption of data $x$ with key $k$ as ${\tt enc}[k](x)$ and ${\tt dec}[k](x)$, respectively. We put overlines (e.g. $\overline{x}$) to indicate encrypted data.

\section{A Seraphis transaction}
Suppose that Alice would send $a_t\in\mathbb{F}$ amount of funds to Bob. Alice owns a set of e-notes $\{(C_i,K_i^o,m_i)\}_{i=1}^n$ with a total amount of $\big(\sum_{i=1}^{n}{a_i}\big)\ge a_t$, all \textit{connected} to a receiver address $(K_{ali}^{dh}, K_{ali}^v, K_{ali}^s)$. This ``connection'' will be elaborated later on. On the other hand, Bob owns a receiver address $(K_{bob}^{dh}, K_{bob}^v, K_{bob}^s)$. For Bob to receive the funds, he will now send his receiver address to Alice. Alice will actually send funds to two addresses: to Bob's and to herself (for the ``change'' $a_c = \sum_{i=1}^{n}{a_i} - a_t$ \textit{even if} $a_c=0$). Hence, Alice must create 2 new e-notes. She starts the transaction by doing the following:
\begin{enumerate}
    \item Generate $r_{ali}, r_{bob}\leftarrow_R\mathbb{F}$ and independent to each other.
    \item Compute $R_{ali} = r_{ali}K_{ali}^{dh}$ and $R_{bob} = r_{bob}K_{bob}^{dh}$, then store $R_{ali}$ and $R_{bob}$ to new (empty) memos $m_{ali}$ and $m_{bob}$, respectively. The name for $K^{dh}$ should now be clear.
    \item Compute the sender-receiver shared secrets $q_{ali} = \mathcal{H}_1(r_{ali}K_{ali}^{v})$ and $q_{bob} = \mathcal{H}_1(r_{bob}K_{bob}^{v})$.
    \item Compute the one-time addresses $K_{ali}^{o} = \mathcal{H}_2(q_{ali})G_1 + K_{ali}^s$ and $K_{bob}^{o} = \mathcal{H}_2(q_{bob})G_1 + K_{bob}^s$. It is easy to see that $\mathcal{H}_2(q_{ali})$ and $\mathcal{H}_2(q_{ali})$ are uniformly random in the random oracle model.
    \item Compute the amount commitments $C_{ali} = \mathcal{H}_3(q_{ali})H_0 + a_c H_1$ and $C_{bob} = \mathcal{H}_3(q_{bob})H_0 + a_t H_1$. It is easy to see that the blinding factors $\mathcal{H}_3(q_{ali})$ and $\mathcal{H}_3(q_{bob})$ are uniformly random in the random oracle model.
    \item Encrypt the amounts: $\overline{a_c} = {\tt enc}[q_{ali}](a_c)$ and $\overline{a_t} = {\tt enc}[q_{ali}](a_t)$, and store $\overline{a_c}$ and $\overline{a_t}$ to memos $m_{ali}$ and $m_{bob}$, respectively.
\end{enumerate}
Alice now has two new e-notes: ${\tt enote}_{ali} = (C_{ali}, K_{ali}^o, m_{ali})$ and ${\tt enote}_{bob} = (C_{bob}, K_{bob}^o, m_{bob})$. These will then be stored to a new (empty) \textit{whole transaction} $T$. Other objects that will be stored to the whole transaction are from proving systems, which are discussed in the next subsections.

On another note, a Seraphis transaction can easily have multiple receivers aside from Bob, which implies that Alice will create more than 2 new e-notes. We did not present this more general instance of Seraphis for the sake of simpler security analysis; extending such analysis to that case must be easy to carry out (see \ref{sec-notes}).

\subsection{Ownership and unspentness proofs}
For each of Alice's owned e-notes in $\{(C_i,K_i^o,m_i)\}_{i=1}^n$, Alice must do the following:
\begin{enumerate}
    \item Generate a \textit{partial} e-note image for $(C_i, K_i^o, m_i)$: ${\tt enimg}_i=(K_i'^o, \tilde{K}_i)$.
    \item Prepare the proof transcripts $\Pi_{\text{o\&u}, i}$ for a non-interactive proving system for the following relation:
$$\{(G_0, G_1, K_i'^o, \tilde{K}_i\in\mathbb{G}; v_k, k_a^o\in\mathbb{F}): k_a^o \ne 0 \wedge K_i'^o = v_k G_0 + k_a^o G_1 \wedge \tilde{K}_i = (1/k_a^o)G_0 \}$$
    \item Store $({\tt enimg}_i, \Pi_{\text{o\&u}, i})$ to $T$.
\end{enumerate}
Aside from verifying the proof transcripts, the Verifier must confirm that the linking tags do not yet appear in the ledger.

\subsection{Amount balance}
For each of Alice's owned e-notes in $\{(C_i,K_i^o,m_i)\}_{i=1}^n$, Alice must do the following:
\begin{enumerate}
    \item Generate the masked amount commitment $C_i'$ for $(C_i, K_i^o, m_i)$ as per definition, \textit{except} for $i=n$. For the case of $i=n$, set
    $$v_{c,n} = \mathcal{H}_3(q_{ali}) + \mathcal{H}_3(q_{bob}) - \sum_{i=1}^{n-1}{v_{c,i}}.$$
    Note that the value of $v_{c,n}$ is still uniformly random because the values of $t_{c,i}$ for $i\in\{1,\ldots,n-1\}$ are uniformly random.
    \item Insert $C_i'$ to ${\tt enimg}_i$ in $T$ to complete the e-note image.
\end{enumerate}
The generation of $v_{c,n}$ is as such so that the Verifier can verify the amount balance $\sum_{i=1}^n{C_i'}=C_{ali}+C_{bob}$.

\subsection{Membership proofs}
For each of Alice's owned e-notes in $\{(C_i,K_i^o,m_i)\}_{i=1}^n$, Alice must do the following:
\begin{enumerate}
    \item Collect $s-1$ number of random e-notes from the ledger and add her owned $(C_i,K_i^o,m_i)$, for a total of $s$ e-notes. The number $s$ is called the \textbf{anonymity size}.
    \item For each e-note in the collection (of size $s$), extract only the amount commitment and one-time address like this: $(C_j, K_j^o)$. Then arrange the $s$ e-notes in random positions. Alice now has an array (of length $s$) of pairs: $\mathbb{S}_i = \{(C_j, K_j^o)\}_{j=1}^s$, which is called the \textbf{ring}. Its elements $(C_j, K_j^o)$ are called the \textbf{ring members}. 
    \item Prepare the proof transcripts $\Pi_{\text{mem}, i}$ for a non-interactive proving system for the following relation:
$$\{(G_0, H_0, C_i', K_i'^o \in\mathbb{G}, \mathbb{S}_i\subset\mathbb{G}^2; \pi\in\mathbb{N}, t_c, t_k\in\mathbb{F}): 1\le\pi\le s \wedge C_i' - C_\pi = t_c H_0 \wedge K_i'^o - K_\pi^o = t_k G_0 \}$$
    \item Append $(\mathbb{S}_i, \Pi_{\text{mem}, i})$ to $({\tt enimg}_i, \Pi_{\text{o\&u}, i})$ in $T$.
\end{enumerate}

\subsection{Range proofs}
For the new e-notes ${\tt enote}_{ali}$ and ${\tt enote}_{bob}$, Alice must do the following:
\begin{enumerate}
    \item Prepare the respective proof transcripts $\Pi_{\text{ran}, ali}$ and $\Pi_{\text{ran}, bob}$ for a non-interactive proving system for the following relation:
$$\{(H_0, H_1, C \in\mathbb{G}, a_{max}\in\mathbb{F}; x, a\in\mathbb{F}): C = x H_0 + a H_1 \wedge 0\le a \le a_{max}\}$$
    \item Store $\Pi_{\text{ran}, ali}$ and $\Pi_{\text{ran}, bob}$ to $T$.
\end{enumerate}

\subsection{Receipt}
Once the construction of $T$ is completed, Alice sends it to the network. Its contents must now be
$$T=({\tt enote}_{ali}, {\tt enote}_{bob}, \Pi_{\text{ran}, ali}, \Pi_{\text{ran}, bob}, \{({\tt enimg}_i, \Pi_{\text{o\&u}, i}, \mathbb{S}_i, \Pi_{\text{mem}, i})\}_{i=1}^n).$$
\noindent Suppose that the Verifier successfully verified $T$, hence $T$ is now stored in the ledger. When Bob scans the ledger for new transactions, he must do the following for every $T$ he encounters:
\begin{enumerate}
    \item Get a new e-note $(C, K^o, m)$ in $T$. Note that $m$ contains $(R, \overline{a})$ (see the beginning of Section 2).
    \item Compute the nominal sender-receiver shared secret: $q_{nom} = \mathcal{H}_1(k_{bob}^v R)$.
    \item Compute the nominal spend public key: $K_{nom}^s = K^o - \mathcal{H}_2(q_{nom})G_1$. If $K_{nom}^s = K_{bob}^s$, then the e-note is \textit{connected} to Bob's receiver address, and proceed to the next step (this is the ``connection'' hinted at the beginning of Section 2).  Otherwise (if not equal), the e-note is not connected, and hence go to Step 1.
    \item Decrypt the amount: $a = {\tt dec}[q_{nom}](\overline a)$.
    \item Compute the nominal amount commitment: $C_{nom} = \mathcal{H}_3(q_{nom})H_0 + a H_1$. If $C_{nom} \ne C$, then the e-note is malformed and cannot be spent.
    \item Compute the nomimal linking tag: $\tilde{K}_{nom} = (1/(k_{a, bob}^s + \mathcal{H}_2(q_{nom})))G_0$. If he finds a copy of $\tilde{K}_{nom}$ in the ledger, then the e-note has already been spent.
\end{enumerate}
If an e-note $(C, K^o, m)$ is connected to Bob's receiver address, then he knows the corresponding scalars of that e-note: $(k_a^o, k_b^o, a, x) = (k_{a, bob}^s + \mathcal{H}_2(q_{nom}), k_{b, bob}^s, a, \mathcal{H}_3(q_{nom}))$. Hence, ``connection'' implies e-note ownership. The transaction is complete for Bob.

For Alice to receive the ``change'' e-note, she must do the same above steps. After that, the transcation is complete for Alice. This finishes a Seraphis trancation.

\section{Security analysis}
\subsection{Zero-knowledge proofs}
\begin{itemize}
    \item \textit{Perfectly Complete}:
    \item \textit{Special Sound}:
    \item \textit{Special Honest Verifier Zero-Knowledge}:
\end{itemize}
Fiat-Shamir heuristic \cite{fiat-shamir} transforms sigma protocols with the above properties into non-interactive zero-knowledge proofs (NIZKPs) in the random oracle model. We require that the proving systems for Ownership and Unspentness proofs, and Range proofs are NIZKPs.
\subsection{Membership proof security properties}
\begin{itemize}
    \item \textit{Correctness}:
    \item \textit{Unforgeability}:
    \item \textit{Anonymity}:
\end{itemize}
\subsection{Peterson commitments}
\begin{itemize}
    \item \textit{Perfectly Hiding}:
    \item \textit{Computationally Binding}:
\end{itemize}
\subsection{Symmetric encryption scheme}
\noindent \textit{IND-CCA2}
\subsection{Seraphis security properties}
\noindent From Omniring
\begin{itemize}
    \item \textit{Correctness}:
    \item \textit{Balance}:
    \item \textit{Privacy}:
    \item \textit{Non-slanderability}:
\end{itemize}
\subsection{Theorems}
\subsection{Notes}\label{sec-notes}

\bibliographystyle{plain}
\bibliography{seraphis}
\end{document}
